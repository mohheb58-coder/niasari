<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø«Ø¨Øª Ø³Ø±ÙˆÛŒØ³ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: Vazirmatn, Tahoma, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .page { display: none !important; }
        .page.active { display: block !important; }
        
        .main-page { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .main-container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 40px; max-width: 500px; width: 100%; text-align: center; }
        .btn-panel { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 18px; margin-bottom: 15px; color: white; transition: all 0.3s; }
        .btn-panel:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-teacher { background: #48bb78; }
        
        .form-page { padding: 30px 20px; }
        .form-container { background: white; border-radius: 15px; padding: 30px; max-width: 1000px; margin: 0 auto; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        .school-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        .school-logo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex-shrink: 0;
            overflow: hidden;
        }
        .school-logo.left { order: 1; }
        .school-logo.right { order: 3; }
        .school-title-container {
            order: 2;
            text-align: center;
            flex-grow: 1;
            padding: 0 20px;
        }
        .school-title {
            color: #667eea;
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }
        .school-subtitle {
            color: #333;
            font-size: 16px;
            margin: 5px 0 0 0;
        }
        
        .card-section { background: #f5f7ff; border: 1px solid #e0e7ff; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .section-title { color: #667eea; font-weight: 700; margin-bottom: 15px; font-size: 15px; }
        .section-title i { margin-left: 5px; }
        .form-group-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-label { color: #333; font-weight: 600; margin-bottom: 6px; font-size: 13px; }
        .form-control, .form-select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 13px; width: 100%; }
        .form-control:focus, .form-select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
        textarea.form-control { min-height: 80px; resize: vertical; }
        .buttons-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px; margin-top: 30px; }
        .btn-custom { padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 13px; color: white; transition: all 0.2s; }
        .btn-save { background: #48bb78; }
        .btn-print { background: #667eea; }
        .btn-delete { background: #718096; }
        
        .amount-input { text-align: left; direction: ltr; }
        
        .signature-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            font-size: 11px;
            color: #555;
        }
        
        @media (max-width: 768px) {
            .form-group-row { grid-template-columns: 1fr; }
            .buttons-group { grid-template-columns: repeat(2, 1fr); }
            .school-logo { width: 80px; height: 80px; }
            .school-title { font-size: 18px; }
            .school-subtitle { font-size: 14px; }
        }
        
        @media (max-width: 576px) {
            .school-header { flex-direction: column; text-align: center; }
            .school-logo { margin-bottom: 10px; }
            .school-title-container { padding: 10px 0; }
        }
    </style>
</head>
<body>
    <!-- Ø¯Ú©Ù…Ù‡ Ù…Ø®ÙÛŒ Ù…Ø¯ÛŒØ± -->
    <div onclick="if(prompt('Ø±Ù…Ø² Ù…Ø¯ÛŒØ±:')==='222564')window.location.href='admin.html'" 
         style="position:fixed; top:0; left:0; width:50px; height:50px; opacity:0.02; cursor:pointer; z-index:9999; background:#000;">
    </div>

    <!-- ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ -->
    <div id="mainPage" class="page active main-page">
        <div class="main-container">
            <h1 style="color:#48bb78;">ğŸš Ø«Ø¨Øª Ø³Ø±ÙˆÛŒØ³ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ</h1>
            <p style="color:#666; margin-bottom:30px; font-size:16px;">
                Ù…Ø¯Ø±Ø³Ù‡ Ø´Ù‡ÛŒØ¯Ø§Ù† Ù†ÛŒØ§Ø³Ø±ÛŒ Û±<br>
                <small style="font-size:13px;">Ù„Ø·ÙØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø¯Ù‚ÛŒÙ‚ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</small>
            </p>
            
            <button class="btn-panel btn-teacher" onclick="showTeacherPanel()" 
                    style="background:#48bb78; width:100%; font-size:20px; padding:20px;">
                ğŸ‘¨â€ğŸ“ Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
            </button>
        </div>
    </div>

    <!-- ØµÙØ­Ù‡ Ø«Ø¨Øª Ø³Ø±ÙˆÛŒØ³ -->
    <div id="teacherFormPage" class="page form-page">
        <div class="form-container">
            <div class="school-header">
                <div class="school-logo left">
                    <img src="https://i.imgur.com/eCxFZCM.jpeg" alt="Ù„ÙˆÚ¯Ùˆ Ù…Ø¯Ø±Ø³Ù‡" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
                </div>
                <div class="school-title-container">
                    <h1 class="school-title">Ù…Ø¯Ø±Ø³Ù‡ Ø´Ù‡ÛŒØ¯Ø§Ù† Ù†ÛŒØ§Ø³Ø±ÛŒ 1</h1>
                    <p class="school-subtitle">Ø³ÛŒØ³ØªÙ… Ø³Ø±ÙˆÛŒØ³ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ</p>
                </div>
                <div class="school-logo right">
                    <img src="https://i.imgur.com/VAsoxgf.jpeg" alt="Ù„ÙˆÚ¯Ùˆ Ù…Ø¯Ø±Ø³Ù‡" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
                </div>
            </div>
            
            <form id="teacherForm" onsubmit="submitTeacherForm(event)">
                <!-- ÙØ±Ù… Ø§ØµÙ„ÛŒ Ù…Ø§Ù†Ù†Ø¯ Ù‚Ø¨Ù„ -->
                <!-- ... Ù…Ø­ØªÙˆØ§ÛŒ ÙØ±Ù… ... -->
            </form>
        </div>
    </div>

    <div id="toastArea" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055;"></div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ÙÙ‚Ø· ØªÙˆØ§Ø¨Ø¹ Ø¶Ø±ÙˆØ±ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆØ§Ù„Ø¯ÛŒÙ†
        const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyofnb9tzrH5pApUKEIhqoZ8643aifoZAQRpC_dumdlJQ_MIU6qD7YJVjq0up6gSI-e/exec";
        
        function showTeacherPanel() { 
            document.getElementById('mainPage').classList.remove('active');
            document.getElementById('teacherFormPage').classList.add('active');
            document.getElementById('teacherForm').reset();
        }
        
        function backToMain() { 
            document.getElementById('teacherFormPage').classList.remove('active');
            document.getElementById('mainPage').classList.add('active');
        }
        
        // ØªÙˆØ§Ø¨Ø¹ ÙØ±Ù… Ùˆ Ø«Ø¨Øª
        function formatAmount(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value.length > 3) {
                value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            input.value = value;
        }
        
        function parseAmount(amountStr) {
            if (!amountStr) return '';
            return amountStr.replace(/[^\d]/g, '');
        }
        
        function showToast(msg, type = 'info') {
            const colors = {success: 'bg-success', danger: 'bg-danger', warning: 'bg-warning', info: 'bg-info'};
            const id = 't' + Date.now();
            const html = `<div id="${id}" class="toast text-white ${colors[type]} border-0"><div class="toast-body">${msg}</div></div>`;
            document.getElementById('toastArea').insertAdjacentHTML('beforeend', html);
            new bootstrap.Toast(document.getElementById(id), { delay: 3000 }).show();
        }
        
        function submitTeacherForm(e) {
            e.preventDefault();
            const form = document.getElementById('teacherForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (key === 'monthlyFare') {
                    data[key] = parseAmount(value);
                } else {
                    data[key] = value;
                }
            }
            
            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!data.studentFullName || !data.fatherName || !data.nationalId || !data.classNumber) {
                showToast('âŒ Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ØŒ Ù†Ø§Ù… Ù¾Ø¯Ø±ØŒ Ø´Ù…Ø§Ø±Ù‡ Ù…Ù„ÛŒ Ùˆ Ù¾Ø§ÛŒÙ‡ ØªØ­ØµÛŒÙ„ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ù‡Ø³ØªÙ†Ø¯', 'danger');
                return;
            }
            
            if (data.nationalId.length !== 10 || isNaN(data.nationalId)) {
                showToast('âŒ Ø´Ù…Ø§Ø±Ù‡ Ù…Ù„ÛŒ Ø¨Ø§ÛŒØ¯ Û±Û° Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯', 'danger');
                return;
            }
            
            // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±
            const cb = 'handleResponse_' + Date.now();
            const params = new URLSearchParams();
            
            params.append('action', 'create');
            params.append('callback', cb);
            
            Object.entries(data).forEach(([key, value]) => {
                if (value !== null && value !== undefined) {
                    params.append(key, value.toString());
                }
            });
            
            const url = WEBAPP_URL + '?' + params.toString();
            const script = document.createElement('script');
            
            window[cb] = function(response) {
                if (response && response.status === 'success') {
                    showToast('âœ… Ø«Ø¨Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
                    form.reset();
                    setTimeout(() => backToMain(), 1500);
                } else {
                    const errorMsg = response && response.message ? response.message : 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±';
                    showToast('âŒ ' + errorMsg, 'danger');
                }
                
                if (document.head.contains(script)) {
                    document.head.removeChild(script);
                }
                delete window[cb];
            };
            
            script.onerror = function() {
                showToast('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±', 'danger');
                if (document.head.contains(script)) {
                    document.head.removeChild(script);
                }
                delete window[cb];
            };
            
            script.src = url;
            document.head.appendChild(script);
        }
        
        function printForm() { 
            // Ú©Ø¯ Ú†Ø§Ù¾ ÙØ±Ù…
            const form = document.getElementById('teacherForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            const formattedFare = data.monthlyFare ? 
                parseInt(parseAmount(data.monthlyFare)).toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†' : '';
            
            let html = `
                <html dir="rtl">
                <head>
                    <meta charset="utf-8">
                    <style>
                        * { margin: 0; padding: 0; font-family: Vazirmatn, Tahoma, Arial; }
                        body { font-size: 11px; line-height: 1.4; padding: 10px; }
                        .container { border: 2px solid #000; padding: 15px; }
                        .print-header {
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                            margin-bottom: 15px;
                            padding-bottom: 10px;
                            border-bottom: 2px solid #000;
                        }
                        .school-logo {
                            width: 80px;
                            height: 80px;
                            border-radius: 50%;
                            object-fit: cover;
                            border: 2px solid #000;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            background: #f0f0f0;
                            flex-shrink: 0;
                            overflow: hidden;
                        }
                        .school-title-container {
                            text-align: center;
                            flex-grow: 1;
                            padding: 0 15px;
                        }
                        .school-title {
                            font-size: 16px;
                            font-weight: bold;
                            margin: 0;
                        }
                        .school-subtitle {
                            font-size: 12px;
                            margin: 3px 0 0 0;
                            color: #333;
                        }
                        .section-title {
                            background: #f0f0f0;
                            padding: 5px 8px;
                            margin: 10px 0 5px 0;
                            font-size: 11px;
                            font-weight: bold;
                            border-bottom: 1px solid #ccc;
                        }
                        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 0; margin-bottom: 0; }
                        .field { border: 1px solid #000; padding: 8px; display: flex; }
                        .field-label { font-weight: bold; width: 40%; text-align: right; padding-left: 10px; }
                        .field-value { width: 60%; text-align: right; border-left: 1px solid #000; padding-right: 8px; }
                        .signature-section {
                            margin-top: 20px;
                            padding-top: 10px;
                            border-top: 1px solid #000;
                            text-align: center;
                            font-size: 10px;
                        }
                        @media print { body { padding: 0; margin: 0; } }
                    </style>
                </head>
                <body>
                <div class="container">
                    <div class="print-header">
                        <div class="school-logo left">
                            <img src="https://i.imgur.com/eCxFZCM.jpeg" 
                                 alt="Ù„ÙˆÚ¯Ùˆ Ù…Ø¯Ø±Ø³Ù‡" 
                                 style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
                        </div>
                        
                        <div class="school-title-container">
                            <h1 class="school-title">Ù…Ø¯Ø±Ø³Ù‡ Ø´Ù‡ÛŒØ¯Ø§Ù† Ù†ÛŒØ§Ø³Ø±ÛŒ 1</h1>
                            <h2 class="school-subtitle">ÙØ±Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÙˆÛŒØ³ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ</h2>
                        </div>
                        
                        <div class="school-logo right">
                            <img src="https://i.imgur.com/VAsoxgf.jpeg" 
                                 alt="Ù„ÙˆÚ¯Ùˆ Ù…Ø¯Ø±Ø³Ù‡" 
                                 style="width:100%;height:100%;border-radius:50%;object-fit:cover;">
                        </div>
                    </div>
                    
                    <div class="section-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</div>
                    <div class="row">
                        <div class="field"><div class="field-label">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</div><div class="field-value">${data.studentFullName || ''}</div></div>
                        <div class="field"><div class="field-label">Ù†Ø§Ù… Ù¾Ø¯Ø±</div><div class="field-value">${data.fatherName || ''}</div></div>
                    </div>
                    <div class="row">
                        <div class="field"><div class="field-label">Ø´Ù…Ø§Ø±Ù‡ Ù…Ù„ÛŒ</div><div class="field-value">${data.nationalId || ''}</div></div>
                        <div class="field"><div class="field-label">Ù¾Ø§ÛŒÙ‡ ØªØ­ØµÛŒÙ„ÛŒ</div><div class="field-value">${data.classNumber || ''}</div></div>
                    </div>
                    <div class="row">
                        <div class="field"><div class="field-label">ØªÙ„ÙÙ† Ù¾Ø¯Ø±</div><div class="field-value">${data.fatherPhone || ''}</div></div>
                        <div class="field"><div class="field-label">ØªÙ„ÙÙ† Ù…Ø§Ø¯Ø±</div><div class="field-value">${data.motherPhone || ''}</div></div>
                    </div>
                    
                    <div class="section-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÙˆÛŒØ³</div>
                    <div class="row">
                        <div class="field"><div class="field-label">Ù†ÙˆØ¹ Ø®ÙˆØ¯Ø±Ùˆ</div><div class="field-value">${data.vehicleType || ''}</div></div>
                        <div class="field"><div class="field-label">Ù†Ø§Ù… Ø±Ø§Ù†Ù†Ø¯Ù‡</div><div class="field-value">${data.driverName || ''}</div></div>
                    </div>
                    <div class="row">
                        <div class="field"><div class="field-label">ØªÙ„ÙÙ† Ø±Ø§Ù†Ù†Ø¯Ù‡</div><div class="field-value">${data.driverPhone || ''}</div></div>
                        <div class="field"><div class="field-label">Ú©Ø±Ø§ÛŒÙ‡ Ù…Ø§Ù‡Ø§Ù†Ù‡</div><div class="field-value">${formattedFare}</div></div>
                    </div>
                    
                    <div class="section-title">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ø¯Ø±Ø³</div>
                    <div class="row">
                        <div class="field" style="grid-column: 1 / -1;">
                            <div class="field-label">Ø¢Ø¯Ø±Ø³ Ù…Ø­Ù„ Ø³Ú©ÙˆÙ†Øª</div>
                            <div class="field-value">${data.address || ''}</div>
                        </div>
                    </div>
                    
                    <div class="signature-section">
                        <p>Ù…Ø¯ÛŒØ± Ù…Ø¯Ø±Ø³Ù‡: Ø­ÛŒØ¯Ø± ÛŒ</p>
                        <p>Ù…Ø¯Ø±Ø³Ù‡ Ø´Ù‡ÛŒØ¯Ø§Ù† Ù†ÛŒØ§Ø³Ø±ÛŒ 1 - Ø³Ø§Ù„ ØªØ­ØµÛŒÙ„ÛŒ Û±Û´Û°Û´-Û±Û´Û°Ûµ</p>
                    </div>
                </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(html);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš ÙØ±Ù… Ø«Ø¨Øª Ø³Ø±ÙˆÛŒØ³ ÙˆØ§Ù„Ø¯ÛŒÙ† Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
        });
    </script>
</body>
</html>